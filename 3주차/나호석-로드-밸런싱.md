# 로드 밸런싱

## 목차

- [로드 밸런싱이란](#로드-밸런싱이란)
- [로드 밸런싱 알고리즘](#로드-밸런싱-알고리즘)
- [로드 밸런싱의 종류](#로드-밸런싱의-종류)
- [출처](#출처)

## 로드 밸런싱이란

### 정의

- 컴퓨터 네트워크 기술의 일종으로 둘 혹은 셋이상의 중앙처리장치 혹은 저장장치와 같은 컴퓨터 자원들에게 작업을 나누는 것을 의미.
- 서버에 부하가 걸리는 것을 분산 처리하는 기술.

![로드밸런서 001](https://user-images.githubusercontent.com/16220817/167804338-dabcdf68-6b64-4678-b2c5-287b02a55649.jpeg)

### 로드 밸런서

- 서버에 가해지는 부하(=로드)를 분산(=밸런싱)해주는 장치 또는 기술을 통칭.

### 발생 배경

- 사용자가 적을 때는 서버 한대로도 운영이 가능.
- 사용자가 많아지면? 트래픽이 많아지고 서버에 부하가 걸린다.
- 해결방법
  - scale up: 서버 성능을 확장.
  - scale out: 기존 서버와 동일한 혹은 낮은 성능의 서버를 추가해 증설. => **여러 대의 서버로 트래픽을 균등하게 할 로드밸런서가 필요!**

## 로드 밸런싱 알고리즘

- 라운드로빈 방식(Round Robin Method)
  - 클라이언트로부터 받은 요청을 로드밸런싱 대상 서버에 순서대로 할당.
  - 여러 대의 서버가 동일한 스펙을 갖고 있고, 서버와의 연결(세션)이 오래 지속되지 않는 경우에 활용하기 적합.
- 가중 라운드로빈 방식(Weighted Round Robin Method)
  - 각각의 서버마다 가중치를 매기고 가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분.
  - 주로 서버의 트래픽 처리 능력이 상이한 경우 사용.
- IP 해시 방식(IP Hash Method)
  - 클라이언트의 IP 주소를 특정 서버로 매핑하여 요청을 처리하는 방식.
  - 사용자가 항상 동일한 서버로 연결되는 것을 보장.
- 최소 연결 방식(Least Connection Method)
  - 요청이 들어온 시점에 가장 적은 연결상태를 보이는 서버에 우선적으로 트래픽을 배분.
  - 자주 세션이 길어지거나, 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합.
- 최소 리스폰타임(Least Response Time Method)
  - 서버의 현재 연결 상태와 응답시간을 모두 고려하여 트래픽을 배분.
  - 가장 적은 연결 상태와 가장 짧은 응답시간을 보이는 서버에 우선적으로 로드를 배분하는 방식.

## 로드 밸런싱의 종류

- OSI 계층에 따라 나누어짐.
- L2, L3, L4, L7.
- L4와 L7을 많이 사용.
  - L4 로드밸런서부터 포트(Port)정보를 바탕으로 로드를 분산하는 것이 가능하기 때문.
  - 한 대의 서버에 각 기 다른 포트 번호를 부여해서 다수의 서버 프로그램을 운영하는 경우에는 최소 L4 로드 밸런서 이상을 사용해야 한다.

### L4 로드 밸런싱 / NLB(Network LoadBalancer)

- 네트워크 계층(IP, IPX)이나 트랜스포트 계층(TCP, UDP)의 정보를 바탕으로 로드를 분산.
- IP주소나 포트번호, MAC주소, 전송 프로토콜에 따라 트래픽을 나누는 것이 가능.
- 장점
  - 패킷으로만 확인하고 분산하기 때문에 속도가 빠르다.
  - 데이터 내용을 복호화할 필요가 없어 비용이 절감.
  - L7 밸런서 보다 가격이 저렴
- 단점
  - 패킷의 내용을 살펴 볼 수 없기에 섬세한 라우팅 불가.
  - 사용자의 IP가 수시로 변경되면 연속적인 서비스를 제공하기 어려움.

### L7 로드 밸런싱 / ALB(Application LoadBalancer)

- 애플리케이션 계층(HTTP, FTP, SMTP)에서 로드를 분산.
- TCP/UDP 정보는 물론 HTTP 헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능.
- DoS/DDoS와 같은 비정상적인 트래픽을 필터링할 수 있어 네트워크 보안 분야에서도 활용.
- 장점
  - 훨씬 더 섬세한 라우팅 가능.
  - 캐싱 기능을 제공.
  - 비정상적인 트래픽을 사전에 필터링 할 수 있음. (패킷을 분석했기 때문에)
- 단점
  - 패킷의 내용을 복호화 해야함으로 더 높은 비용이 필요.
  - 클라이언트와 로드 밸런서가 인증서를 공유해야하기 때문에 공격자가 로드밸런서를 통해서 클라이언트 데이터에 접근할 보안상의 위험 존재.

## 출처

- [위키백과 부하분산](https://ko.wikipedia.org/wiki/%EB%B6%80%ED%95%98%EB%B6%84%EC%82%B0)
- [로브 밸런서의 개념과 특징](https://m.post.naver.com/viewer/postView.naver?volumeNo=27046347&memberNo=2521903)
- [로드 밸런싱 종류와 알고리즘](https://dev.classmethod.jp/articles/load-balancing-types-and-algorithm/)
- [제이미의 Forward Proxy, Reverse Proxy, Load Balancer](https://youtu.be/YxwYhenZ3BE)
