# 💥캐시

캐시를 한마디로 말하면

- **자주 사용할 것 같은 데이터를 저장해 놓는 임시 저장소❗**

라고 할 수 있습니다

## 1️⃣ 캐시는 시간 효율성을 위해 사용됩니다.

    예를 들어 한국에 있는 제가 미국에 있는 서버의 데이터를 가져와 사용한다고 해봅시다. 매 요청마다 한국부터 미국까지 먼길을 타고 데이터를 받아와야 합니다. 이 때 동일한 데이터를 계속 가져오는 상황이라면,  매번 한국에서 미국까지 네트워크 요청을 보내 가져오는 것 보다, 최초 한번만 네트워크 요청을 하고, 받아온 데이터는 내 컴퓨터에 저장합니다. 그리고 다음부터는 `네트워크 요청을 보내는 것 대신 내 컴퓨터에 저장된 데이터를 사용하는 것`이 훨씬 빠르고 효율적일 것입니다.

    정리하자면 데이터를 가져오는 시간을 단축시키기 위해 데이터를 저장하는 임시 공간을 캐시라고 합니다.

## 2️⃣ 캐시는 컴퓨터 과학 여러 분야에서 사용되는 용어입니다.

    위 예시는 `브라우저 캐시` 에 대한 이야기입니다. 브라우저 캐시뿐만 아니라 다양한 캐시가 존재합니다.

가장 low한 레벨에서는 실제 물리적으로 존재하는 `하드웨어 캐시` 가 있습니다

- 폰 노이만 병목현상을 어느정도 해결할 수 있습니다
  - CPU는 빠른데, 메모리에서 가져오는 데이터 이동속도가 느려 성능 저하가 생기는 것
- 그러나 가격이 매우 비쌉니다
- L1, L2, L3 캐시로 레이어를 두어 사용합니다. 여기서는 자세히 다루지 않겠습니다

다음으로는 `디스크 캐시` 가 있고 우리 프론트엔드 개발자가 잘 알아야할 `웹 캐시` 가 있습니다. 그 외에도 데이터베이스에서 사용하는 캐시등등 다양한 캐시 종류가 있습니다

## 3️⃣ `지역성` 개념에 대해 짚고 넘어가겠습니다

캐시가 효율적으로 동작하기 위해서는 캐시에 저장되는 데이터가 지역성을 가져야 한다고 표현합니다. 캐시에 관련된 용어를 잠깐 정리해보도록 합시다

- 원본 저장소에서 데이터를 가져오기 전에, 캐시에 그 데이터가 있는지 여부를 확인합니다. 만약 있으면 `Hit(적중)`, 없으면 `Miss(실패)`라고 부릅니다
- `Hit Ratio` (적중률)은 적중횟수 / 전체 메모리 참조 횟수가 됩니다.

알고리즘에서 시간복잡도, 공간복잡도로 나누듯이 캐시의 지역성 개념에서도 시간지역성, 공간지역성으로 나눌 수 있습니다

- 시간 지역성 : 최근에 가져온 데이터를 다시 참조하게 되는 특성
- 공간 지역성 : 메모리 가까이에 있는 데이터를 다시 참조하게 되는 특성

정리하면 캐시는 지역성을 높여 최대한 빠르고 효율적으로 동작시켜야 합니다.

## 4️⃣ 브라우저 캐시

프론트엔드 개발자가 해야할 중요한 역할 중 하나는, 빠른 웹 사이트를 만드는 것입니다. 빠른 로딩 속도는 서비스의 비지니스와도 직접적으로 연관되어 있기 때문이죠. 그러기 위해서는 캐시를 잘 사용하는 것이 중요합니다. 그렇다면 여기서 궁금한 점이 생깁니다.

**과연 모든 데이터를 캐싱하는 것이 좋을까요?**

우리가 어떤 홈페이지에 들어가면 제일 먼저 서버에게 요청하는 것이 index.html 파일입니다. 이 index.html 파일이 만약 캐싱되어있다면 어떤 일이 벌어질까요?

개발자가 아무리 새로운 기능을 추가해서 매번 다른 index.html 파일을 업데이트하더라도 캐싱된 데이터를 사용하는 유저는 매번 똑같은 index.html을 캐시에서 가져오게 되기 때문에 같은 화면만을 보게 될 것입니다.

이처럼 어떤 파일을 캐싱하고 안 할지, 또 얼마만큼의 기간을 캐싱할지를 정하는 `캐싱 전략` 이 필요합니다.

캐싱 전략을 효과적으로 구사하기 위해서, HTTP 프로토콜의 `Cache-control` 헤더를 잘 사용하는 것이 중요합니다. 브라우저는 헤더를 읽고, 어떤 리소스를 캐싱할지 살펴봅니다

### 캐시의 유효기간을 설정하는 `max-age`

- Cache-control 헤더 값에 max-age로 리소스의 유효기간을 설정할 수 있습니다

### 유효기간이 지났다면? 재검증❗

- 만약 리소스의 유효기간이 지났다면 리소스가 바로 삭제되고 새로운 리소스를 요청하게 될까요?
- 그전에 한번 더 최적화 작업을 하게 됩니다
- `재검증` 을 수행하여 내가 지금 가지고 있는 리소스가 서버의 리소스와 일치하는지 확인합니다.

  - ETag라는 식별자를 사용합니다. (여기서는 자세히 다루지 않겠습니다)
  - 만약 일치하지 않는다면 새로운 리소스를 받아와 사용합니다. 일치한다면 그대로 사용

- 그 밖에 다양한 캐시 전략들이 있습니다

## 마지막으로 CDN

마지막으로 CDN을 소개하겠습니다. CDN은 캐시 클라우드 서버입니다. 전세계에 서버를 두고, 동일한 파일을 캐싱해두는 것 입니다. 만약 한국에 사는 제가 CDN 서버를 사용해 파일을 업로드하면, 파리에 있는 CDN 서버, 미국에 있는 CDN 서버 등등 동일한 파일이 업로드 되고 미국에 사는 사람은 근처 CDN 서버에서 빠르게 데이터를 불러올 수 있게 됩니다.

- 가장 유명한 AWS의 cloudflare 서비스가 있습니다

앞에서 브라우저 캐시에 대해 소개해드렸습니다. 만약 CDN을 사용하게 된다면 다음과 같이 CDN 캐시와 브라우저 캐시 , 두 계층의 캐시를 사용하게 됩니다. 여러 레이어에서 캐시를 다루기 위해서 앞서 말씀드렸던 HTTP 프로토콜의 캐시 헤더를 잘 다룰 수 있어야합니다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5faccf89-6987-4f6c-9140-c725ddfa4f5c/Untitled.png)
