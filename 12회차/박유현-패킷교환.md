# 네트워크 코어

네트워크 코어는 네트워크 엣지인 종단 시스템, End system을 연결하는 패킷 스위치들(라우터와 링크 계층의 스위치)과 링크들의 연결망이다. 네트워크 코어의 역할은 **송신 종단 시스템에서 목적지 종단 시스템으로 애플리케이션 계층의 메시지를 보내는 것**이다. 전달하는 방법으로는 크게 회선 교환, Circuit switching과 패킷 교환, Packet switching이 있다.

![image](https://user-images.githubusercontent.com/96400112/197376040-f92ccd16-6949-47ec-9494-e572a7383b3a.png)

<br />

# 회선 교환

회선 교환 방식은 주로 **전화 네트워크**에서 사용되던 방법이다. 

![image](https://user-images.githubusercontent.com/96400112/197376049-acbefb34-2f9d-405a-bd25-00bbc8f9a713.png)

## 특징

- 종단간 연결 경로를 설정하여 자원을 미리 **예약**하는 call setup 단계가 필요
- 공유 회선, shared link가 아닌 **전용 회선, dedicated link**
- 일정 수준 이상의 **전송률을 보장**할 수 있음

<br />

# 패킷 교환

패킷 교환은 인터넷의 등장으로 고안된 통신 방식이다.

## 특징

- Call setup 단계가 없음
- 네트워크 자원 예약 없이 링크의 대역폭을 전부 사용
    - 종단 시스템에서 ‘패킷, packet’이라는 작은 데이터 덩어리로 분할하여 통신
    - 패킷에 목적지 주소 명시
- 저장-후-전달 전송, Store-and-forward tranmission 방식
    - 출력 링크로 패킷의 첫 비트를 전송하기 전에, 패킷의 전체를 받아야만 할 수 있음
    - 출력 버퍼/큐에 전송 전 패킷을 저장
        - 네트워크 혼잡도에 따라 큐잉 지연 및 패킷 손실 발생

## 지연

패킷은  경로상의 각 노드(호스트, 라우터, 스위치)에서 다양한 지연을 겪게 된다. 노드 처리 지연, 큐잉 지연, 전송 지연, 전파 지연으로 총 4가지 유형이 있으며 이들의 합을 전체 지연이라 한다.

![image](https://user-images.githubusercontent.com/96400112/197376055-82137b7a-423e-4cfc-84cb-aba38522622f.png)

### 노드 처리 지연, *d*proc

- 패킷이 노드에 도착하고, 노드에서 패킷을 처리하는 시간
- 패킷의 비트 오류 확인
- 패킷 헤더 조사 후 출력 링크 결정
- 일반적으로 수 ms 이하의 지연

### 큐잉 지연, *d*queue

- 패킷이 출력 큐에 저장되어 출력 링크로 전송되기를 기다리는 시간
- 네트워크 혼잡도에 따라 달라지는 가변값
- 일반적으로 μs ~ ms 이하의 지연

### 전송 지연, *d*trans

- 패킷의 모든 비트를 출력 링크로 밀어내는 데 걸리는 시간
- 패킷의 크기(L, bits) / 출력 링크의 대역폭(R, bps)
- 일반적으로 μs ~ ms 이하의 지연

### 전파 지연, *d*prop

- 비트가 다음 노드로 전파되는 데 걸리는 시간
- 출력 링크의 길이(d, m)  / 링크의 전파 속도(s, m/sec)
- 광역 네트워크에서 일반적으로 sec 이하의 지연

## 트래픽 강도

트래픽 강도, traffic intensity 는 큐잉 지연의 정도를 측정하는데 중요한 지표 역할을 한다. 트래픽 강도는 아래의 식으로 표현된다. 즉 **트래픽 유입 속도**와 **패킷을 출력 링크로 밀어내는 속도**의 비율이다. 

```
traffic intensity = L * a / R
```

- R: 출력 링크의 전송률 (bps)
- a: 패킷이 큐에 도착하는 평균율 (packets / sec)
- L: 패킷의 길이, (bits)

![image](https://user-images.githubusercontent.com/96400112/197376063-5f3e5b60-0be3-4a2a-a8e0-f590079e3a6c.png)

위 그래프는 평균 큐잉 지연의 트래픽 강도 의존성을 나타낸다.

- 트래픽 강도가 0에 가까운 것은 트래픽 유입 속도보다 밀어내는 속도가 빠르며 평균 큐잉 지연이 작다
- 트래픽 강도가 1에 가까운 것은 트래픽 유입 속도보다 밀어내는 속도가 비슷하며 평균 큐잉 지연이 무한대에 가깝다.
    - 평균 큐잉 지연이 급속히 증가하는 이유는 패킷이 큐에 도착하는 평균율인 a의 값이 평균이기 때문이다. 경우에 따라 일시적으로 패킷이 큐에 도착하는 속도가 밀어내는 속도보다 높아질 수 있다.

## 패킷 손실

패킷 손실, packet loss 은 트래픽 강도가 1에 가까운 네트워크 상황에서 출력 링크 큐의 크기가 **유한**하다는 점 때문에 발생한다. 큐가 꽉 찼을 때 패킷이 도착하면, 라우터는 패킷을 버린다. 패킷 손실이 발생하면, 종단간 데이터 전송 보장을 위해 **재전송**될 수 있다.

## 처리율

처리율, throughput 은 단위 시간당 송신으로부터 목적지까지 전송한 트래픽의 양 (bits/time unit)을 의미한다. 아래의 그림처럼 2개의 통신 링크와 라우터로 연결된 하나의 서버-클라이언트 예시로 처리율을 살펴보자. 

![image](https://user-images.githubusercontent.com/96400112/197376071-08abb149-9a8c-4e3c-a1c1-2fbcf56d466a.png)

- 서버와 라우터 간의 링크 속도, Rs bits/sec
- 라우터와 클라이언트 간의 링크 속도, Rc bits/sec
- 서버와 클라이언트 간의 처리율, `Math.min(Rs, Rc)`
    - 경로 내 링크 속도 중 최솟값으로 제한

처리율을 제한시키는 링크, 즉 최솟값의 전송률을 가진 링크를 **병목 링크**, bottleneck link라 하며, 인터넷에서는 네트워크 코어보다는 엣지에 속하는 링크들이다.

<br />

# 참고

*Computer Networking: A Top-Down Approach 6th ed .J.F. Kurose and K.W. Ross*

[http://www.kocw.net/home/cview.do?cid=e44bdd9b3a3f9bb5](http://www.kocw.net/home/cview.do?cid=e44bdd9b3a3f9bb5)
